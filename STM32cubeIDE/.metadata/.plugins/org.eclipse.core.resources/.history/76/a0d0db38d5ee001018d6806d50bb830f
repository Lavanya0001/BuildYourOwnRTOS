/*
 * timebase.c
 *
 *  Created on: Jan 10, 2026
 *      Author: lavanyaimadabattina
 */
#include "timebase.h"
#include "stm32wb55xx.h"

#define ONE_SEC_LOAD	4000000

#define CTRL_EN			(1U << 0)
#define CTRL_TICKINT	(1U << 1)
#define CTRL_CLKSRC		(1U << 2)
#define CTRL_COUNTFLAG	(1U << 16)

void timebase_init(void){
	/* Reload the timer with number of cycles per second*/
	SysTick->LOAD = ONE_SEC_LOAD - 1;

	/* Clear Systick current value register*/
	SysTick->VAL = 0;

	/* Select internal clock source*/
	SysTick->CTRL = CTRL_CLKSRC;

	/* Enable interrupt */
	SysTick->CTRL |= CTRL_TICKINT;

	/* Enable systick */
	SysTick->CTRL |= CTRL_EN;

	/* Enable global interrupts */
	__enable_irq();
}
